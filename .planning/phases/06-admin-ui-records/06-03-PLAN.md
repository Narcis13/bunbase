---
phase: 06-admin-ui-records
plan: 03
type: execute
wave: 3
depends_on: ["06-02"]
files_modified:
  - src/admin/components/dashboard/Dashboard.tsx
  - src/admin/components/dashboard/CollectionCard.tsx
  - src/admin/App.tsx
autonomous: true

must_haves:
  truths:
    - "Admin sees collection statistics on dashboard"
    - "Each collection card shows record count"
    - "Dashboard is the entry point after login"
    - "Clicking collection card navigates to that collection"
  artifacts:
    - path: "src/admin/components/dashboard/Dashboard.tsx"
      provides: "Dashboard view with collection stats grid"
      min_lines: 40
    - path: "src/admin/components/dashboard/CollectionCard.tsx"
      provides: "Individual collection stat card"
      min_lines: 20
  key_links:
    - from: "src/admin/App.tsx"
      to: "src/admin/components/dashboard/Dashboard.tsx"
      via: "component import and render"
      pattern: "import.*Dashboard"
    - from: "src/admin/components/dashboard/Dashboard.tsx"
      to: "src/admin/hooks/useCollections.ts"
      via: "hook call"
      pattern: "useCollections"
---

<objective>
Create the dashboard view with collection statistics cards

Purpose: Provide an overview of all collections with record counts as the admin entry point (UI-08)
Output: Dashboard with grid of collection cards showing stats
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-admin-ui-records/06-CONTEXT.md
@src/admin/App.tsx
@src/admin/hooks/useCollections.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dashboard components</name>
  <files>
    - src/admin/components/dashboard/Dashboard.tsx
    - src/admin/components/dashboard/CollectionCard.tsx
  </files>
  <action>
**Create src/admin/components/dashboard/CollectionCard.tsx**:

A card component showing collection stats:

```typescript
import { Database, FileText, Clock } from "lucide-react";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { formatDistanceToNow } from "date-fns";

interface CollectionCardProps {
  name: string;
  recordCount: number;
  fieldCount: number;
  updatedAt: string;
  onClick: () => void;
}

export function CollectionCard({
  name,
  recordCount,
  fieldCount,
  updatedAt,
  onClick,
}: CollectionCardProps) {
  return (
    <Card
      className="cursor-pointer transition-colors hover:bg-accent"
      onClick={onClick}
    >
      <CardHeader className="pb-2">
        <CardTitle className="flex items-center gap-2 text-base">
          <Database className="h-4 w-4" />
          {name}
        </CardTitle>
        <CardDescription>
          {fieldCount} field{fieldCount !== 1 ? "s" : ""}
        </CardDescription>
      </CardHeader>
      <CardContent>
        <div className="flex items-center justify-between text-sm">
          <div className="flex items-center gap-1 text-muted-foreground">
            <FileText className="h-3.5 w-3.5" />
            <span>{recordCount} record{recordCount !== 1 ? "s" : ""}</span>
          </div>
          <div className="flex items-center gap-1 text-muted-foreground">
            <Clock className="h-3.5 w-3.5" />
            <span>{formatDistanceToNow(new Date(updatedAt), { addSuffix: true })}</span>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}
```

**Create src/admin/components/dashboard/Dashboard.tsx**:

```typescript
import { useCollections } from "@/hooks/useCollections";
import { CollectionCard } from "./CollectionCard";
import { Skeleton } from "@/components/ui/skeleton";
import { Database } from "lucide-react";

interface DashboardProps {
  onNavigateToCollection: (collection: string) => void;
}

export function Dashboard({ onNavigateToCollection }: DashboardProps) {
  const { collections, loading, error } = useCollections();

  // Filter out system collections for the main grid
  const userCollections = collections.filter((c) => !c.name.startsWith("_"));
  const systemCollections = collections.filter((c) => c.name.startsWith("_"));

  // Calculate totals
  const totalRecords = collections.reduce((sum, c) => sum + c.recordCount, 0);
  const totalCollections = userCollections.length;

  if (error) {
    return (
      <div className="text-center py-12">
        <p className="text-destructive">Error loading collections: {error}</p>
      </div>
    );
  }

  return (
    <div className="space-y-8">
      {/* Summary stats */}
      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
        <div className="rounded-lg border bg-card p-4">
          <div className="text-sm font-medium text-muted-foreground">
            Total Collections
          </div>
          <div className="mt-1 text-2xl font-bold">
            {loading ? <Skeleton className="h-8 w-16" /> : totalCollections}
          </div>
        </div>
        <div className="rounded-lg border bg-card p-4">
          <div className="text-sm font-medium text-muted-foreground">
            Total Records
          </div>
          <div className="mt-1 text-2xl font-bold">
            {loading ? <Skeleton className="h-8 w-16" /> : totalRecords}
          </div>
        </div>
      </div>

      {/* Collections grid */}
      <div>
        <h2 className="text-lg font-semibold mb-4">Collections</h2>
        {loading ? (
          <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
            {[1, 2, 3].map((i) => (
              <Skeleton key={i} className="h-32 w-full" />
            ))}
          </div>
        ) : userCollections.length === 0 ? (
          <div className="text-center py-12 border rounded-lg bg-muted/50">
            <Database className="h-12 w-12 mx-auto text-muted-foreground" />
            <h3 className="mt-4 text-lg font-medium">No collections yet</h3>
            <p className="mt-1 text-sm text-muted-foreground">
              Collections will appear here once created
            </p>
          </div>
        ) : (
          <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
            {userCollections.map((collection) => (
              <CollectionCard
                key={collection.id}
                name={collection.name}
                recordCount={collection.recordCount}
                fieldCount={collection.fieldCount}
                updatedAt={collection.updated_at}
                onClick={() => onNavigateToCollection(collection.name)}
              />
            ))}
          </div>
        )}
      </div>

      {/* System collections (smaller, less prominent) */}
      {systemCollections.length > 0 && (
        <div>
          <h2 className="text-sm font-medium text-muted-foreground mb-3">
            System Collections
          </h2>
          <div className="grid gap-2 md:grid-cols-3 lg:grid-cols-4">
            {systemCollections.map((collection) => (
              <button
                key={collection.id}
                onClick={() => onNavigateToCollection(collection.name)}
                className="flex items-center gap-2 rounded-md border p-2 text-left text-sm hover:bg-accent transition-colors"
              >
                <Database className="h-3.5 w-3.5 text-muted-foreground" />
                <span className="font-medium">{collection.name}</span>
                <span className="ml-auto text-muted-foreground">
                  {collection.recordCount}
                </span>
              </button>
            ))}
          </div>
        </div>
      )}
    </div>
  );
}
```
  </action>
  <verify>
    - `ls src/admin/components/dashboard/` shows Dashboard.tsx, CollectionCard.tsx
    - `bun run typecheck` passes
  </verify>
  <done>
    Dashboard and CollectionCard components created with stats display
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate dashboard into App</name>
  <files>
    - src/admin/App.tsx
  </files>
  <action>
**Update src/admin/App.tsx**:

Replace the DashboardPlaceholder with the real Dashboard component:

1. Remove import of DashboardPlaceholder
2. Add import: `import { Dashboard } from "@/components/dashboard/Dashboard";`
3. Replace the DashboardPlaceholder render with:

```tsx
{view.type === "dashboard" && (
  <Dashboard
    onNavigateToCollection={(collection) =>
      setView({ type: "collection", collection })
    }
  />
)}
```

The Dashboard component receives a callback to navigate to collections when cards are clicked.

You can also delete src/admin/components/views/DashboardPlaceholder.tsx since it's no longer needed.
  </action>
  <verify>
    - `grep "Dashboard" src/admin/App.tsx` shows Dashboard import and usage
    - `bun run typecheck` passes
    - Start server: `JWT_SECRET=test bun run src/api/server.ts`
    - Browser at /_/ after login shows dashboard with:
      - Summary stats (total collections, total records)
      - Collection cards in a grid
      - Clicking a card navigates to that collection
  </verify>
  <done>
    Dashboard integrated as the main view after login (UI-08)
  </done>
</task>

</tasks>

<verification>
1. `bun run typecheck` - No TypeScript errors
2. Start server: `JWT_SECRET=test bun run src/api/server.ts`
3. Create a test collection if none exist:
   ```bash
   curl -X POST http://localhost:8090/api/collections/test/records \
     -H "Content-Type: application/json" \
     -d '{"name": "test"}'
   ```
4. Browser at http://localhost:8090/_/:
   - Login shows dashboard
   - Dashboard shows collection cards with record counts
   - Empty state shows "No collections yet" message
   - Click collection card navigates to collection view
   - System collections shown in smaller section at bottom
</verification>

<success_criteria>
- Dashboard displays collection statistics (UI-08)
- Each collection card shows: name, field count, record count, last updated
- Clicking collection card navigates to that collection's view
- Empty state handled gracefully
- Loading states with skeletons
- Error states displayed
- System vs user collections visually distinguished
</success_criteria>

<output>
After completion, create `.planning/phases/06-admin-ui-records/06-03-SUMMARY.md`
</output>
