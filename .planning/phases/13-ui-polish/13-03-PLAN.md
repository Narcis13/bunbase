---
phase: 13-ui-polish
plan: 03
type: execute
wave: 2
depends_on: ["13-01", "13-02"]
files_modified:
  - src/admin/components/records/RecordsTable.tsx
  - src/admin/components/schema/FieldsTable.tsx
  - src/admin/components/layout/Layout.tsx
  - src/admin/components/dashboard/Dashboard.tsx
  - src/admin/components/records/RecordsView.tsx
autonomous: false

must_haves:
  truths:
    - "User can navigate table rows using arrow keys"
    - "User can activate table row with Enter/Space"
    - "Admin UI is usable on tablet viewport (768px)"
    - "Admin UI is usable on mobile viewport (375px)"
    - "Spacing is consistent throughout UI"
  artifacts:
    - path: "src/admin/components/records/RecordsTable.tsx"
      provides: "Table with keyboard navigation"
      contains: "onKeyDown"
    - path: "src/admin/components/schema/FieldsTable.tsx"
      provides: "Table with keyboard navigation"
      contains: "onKeyDown"
    - path: "src/admin/components/layout/Layout.tsx"
      provides: "Responsive layout"
      contains: "md:"
  key_links:
    - from: "src/admin/components/records/RecordsTable.tsx"
      to: "keyboard events"
      via: "onKeyDown handler"
      pattern: "onKeyDown.*ArrowDown|ArrowUp"
---

<objective>
Add keyboard navigation to tables and refine responsive layout for tablet/mobile viewports.

Purpose: Keyboard users cannot currently navigate table rows with arrow keys or activate rows with Enter/Space. Additionally, the admin UI needs responsive refinements for smaller viewports to complete the UI polish requirements.

Output: Keyboard-accessible tables and responsive layout improvements.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/13-ui-polish/13-RESEARCH.md
@src/admin/components/records/RecordsTable.tsx
@src/admin/components/schema/FieldsTable.tsx
@src/admin/components/layout/Layout.tsx
@src/admin/components/layout/AppSidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add keyboard navigation to RecordsTable</name>
  <files>src/admin/components/records/RecordsTable.tsx</files>
  <action>
Add keyboard navigation to RecordsTable for accessibility.

Requirements:
1. Table rows should be focusable (tabIndex={0})
2. Arrow Up/Down should move focus between rows
3. Enter/Space should activate the row (call onRowClick)
4. Add focus ring styling (focus:outline-none focus:ring-2 focus:ring-ring)

Implementation approach:

1. Add tabIndex and onKeyDown to TableRow:
```tsx
<TableRow
  key={row.id}
  tabIndex={0}
  className="cursor-pointer focus:outline-none focus:ring-2 focus:ring-ring focus:ring-inset"
  onClick={() => onRowClick(row.original)}
  onKeyDown={(e) => {
    if (e.key === "Enter" || e.key === " ") {
      e.preventDefault();
      onRowClick(row.original);
    }
    if (e.key === "ArrowDown") {
      e.preventDefault();
      const nextRow = e.currentTarget.nextElementSibling as HTMLElement;
      nextRow?.focus();
    }
    if (e.key === "ArrowUp") {
      e.preventDefault();
      const prevRow = e.currentTarget.previousElementSibling as HTMLElement;
      prevRow?.focus();
    }
  }}
>
```

2. Ensure the actions dropdown button stops event propagation (already done with onClick stopPropagation, add for keyboard too if needed).

Note: Using DOM traversal (nextElementSibling/previousElementSibling) is simpler than ref arrays for this use case and works well with TanStack Table.
  </action>
  <verify>bun run build passes</verify>
  <done>RecordsTable rows are keyboard navigable with arrow keys and activatable with Enter/Space</done>
</task>

<task type="auto">
  <name>Task 2: Add keyboard navigation to FieldsTable</name>
  <files>src/admin/components/schema/FieldsTable.tsx</files>
  <action>
Add the same keyboard navigation pattern to FieldsTable.

First read the current FieldsTable.tsx to understand its structure, then apply the same pattern as RecordsTable:

1. Add tabIndex={0} to rows
2. Add focus ring styling
3. Add onKeyDown handler for Arrow Up/Down and Enter/Space
4. Ensure onRowClick or onEdit is called on Enter/Space

The specific callback depends on how FieldsTable handles row interactions - it may use onEdit directly.
  </action>
  <verify>bun run build passes</verify>
  <done>FieldsTable rows are keyboard navigable with arrow keys and activatable with Enter/Space</done>
</task>

<task type="auto">
  <name>Task 3: Responsive layout refinements</name>
  <files>
    src/admin/components/layout/Layout.tsx
    src/admin/components/dashboard/Dashboard.tsx
    src/admin/components/records/RecordsView.tsx
  </files>
  <action>
Audit and refine responsive layout for tablet (768px) and mobile (375px) viewports.

**Layout.tsx:**
Check that the sidebar collapse behavior works correctly on mobile. The SidebarProvider from shadcn/ui should handle this, but verify:
- Header should have appropriate padding on mobile
- Main content area should not overflow

**Dashboard.tsx:**
Ensure the collection cards grid is responsive:
- Currently may need: `grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4`
- Check for any hardcoded widths that might cause overflow

**RecordsView.tsx:**
1. The header with "New Record" button should stack vertically on mobile:
```tsx
<div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
```

2. Pagination controls should be responsive:
```tsx
<div className="flex flex-col sm:flex-row items-center justify-between gap-2">
```

3. Ensure table wrapper allows horizontal scroll on small screens:
```tsx
<div className="overflow-x-auto">
  <RecordsTable ... />
</div>
```

**Spacing audit:**
Verify consistent spacing scale usage:
- Sections: gap-6 or space-y-6 (24px)
- Form fields: space-y-4 (16px)
- Inline elements: gap-2 (8px)
- Page padding: p-4 (16px)

Fix any inconsistent spacing found during the audit.
  </action>
  <verify>bun run build passes</verify>
  <done>Layout responds correctly to tablet and mobile viewports with no overflow or broken layouts</done>
</task>

</tasks>

<verification>
1. Build passes: `bun run build`
2. Keyboard navigation test:
   - Focus a table row with Tab
   - Press Arrow Down - focus moves to next row
   - Press Arrow Up - focus moves to previous row
   - Press Enter - row click handler fires (edit dialog opens)
3. Responsive test:
   - Open dev tools, set viewport to 768px width (tablet)
   - Verify sidebar collapses, content is readable
   - Set viewport to 375px width (mobile)
   - Verify no horizontal overflow, buttons stack appropriately
</verification>

<success_criteria>
- Table rows are keyboard navigable (Arrow Up/Down)
- Table rows are activatable via keyboard (Enter/Space)
- Focus rings are visible on focused rows
- UI displays correctly on tablet viewport (768px)
- UI displays correctly on mobile viewport (375px)
- No content overflow on small screens
- Consistent spacing throughout
</success_criteria>

<checkpoint type="human-verify" gate="blocking">
  <what-built>Keyboard navigation for tables and responsive layout refinements</what-built>
  <how-to-verify>
    1. Start dev server: `bun run dev`
    2. Navigate to a collection with records
    3. Tab to focus a table row
    4. Use Arrow Up/Down to navigate between rows
    5. Press Enter to open edit dialog
    6. Open dev tools, toggle device toolbar
    7. Set viewport to 768px width - verify layout
    8. Set viewport to 375px width - verify layout
    9. Test on Dashboard and Schema views as well
  </how-to-verify>
  <resume-signal>Type "approved" if keyboard navigation works and responsive layouts look correct, or describe issues found</resume-signal>
</checkpoint>

<output>
After completion, create `.planning/phases/13-ui-polish/13-03-SUMMARY.md`
</output>
