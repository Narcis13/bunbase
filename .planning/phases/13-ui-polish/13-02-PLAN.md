---
phase: 13-ui-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/admin/components/records/DynamicField.tsx
  - src/admin/components/schema/FieldForm.tsx
  - src/admin/components/views/LoginPage.tsx
  - src/admin/components/schema/CreateCollectionSheet.tsx
autonomous: true

must_haves:
  truths:
    - "Form inputs have aria-invalid attribute when validation fails"
    - "Validation errors appear inline below the invalid field"
    - "Screen readers announce invalid form fields"
    - "Login form validates before submission"
  artifacts:
    - path: "src/admin/components/records/DynamicField.tsx"
      provides: "Dynamic field with aria-invalid support"
      contains: "aria-invalid"
    - path: "src/admin/components/views/LoginPage.tsx"
      provides: "Login form with inline validation"
      contains: "aria-invalid"
    - path: "src/admin/components/schema/FieldForm.tsx"
      provides: "Field form with aria-invalid support"
      contains: "aria-invalid"
  key_links:
    - from: "src/admin/components/records/DynamicField.tsx"
      to: "aria-invalid attribute"
      via: "prop spread on Input/Textarea"
      pattern: "aria-invalid=\\{!!error\\}"
---

<objective>
Enhance form validation with aria-invalid attributes for accessibility and consistent inline error styling.

Purpose: Screen reader users need aria-invalid to know which fields have validation errors. Currently forms show error messages but inputs lack the aria-invalid attribute, making them inaccessible to users with assistive technologies.

Output: Updated form components with proper accessibility attributes and consistent validation styling.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/13-ui-polish/13-RESEARCH.md
@src/admin/components/records/DynamicField.tsx
@src/admin/components/schema/FieldForm.tsx
@src/admin/components/views/LoginPage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add aria-invalid to DynamicField inputs</name>
  <files>src/admin/components/records/DynamicField.tsx</files>
  <action>
Add aria-invalid attribute to all input types in DynamicField component.

For each input type rendered (Input, Textarea, Switch), add `aria-invalid={!!error}` prop.

Changes needed:

1. For "text" type Input:
```tsx
<Input
  id={field.name}
  {...formField}
  value={(formField.value as string) ?? ""}
  placeholder={`Enter ${field.name}`}
  aria-invalid={!!error}
/>
```

2. For "number" type Input:
```tsx
<Input
  id={field.name}
  type="number"
  step="any"
  {...formField}
  value={(formField.value as number) ?? ""}
  onChange={(e) => {
    const val = e.target.value;
    formField.onChange(val === "" ? null : Number(val));
  }}
  placeholder={`Enter ${field.name}`}
  aria-invalid={!!error}
/>
```

3. For "datetime" type Input:
```tsx
<Input
  id={field.name}
  type="datetime-local"
  {...formField}
  value={formatDateForInput(formField.value as string)}
  onChange={(e) => {
    const val = e.target.value;
    formField.onChange(val ? new Date(val).toISOString() : null);
  }}
  aria-invalid={!!error}
/>
```

4. For "json" type Textarea:
```tsx
<Textarea
  id={field.name}
  {...formField}
  value={...}
  onChange={...}
  placeholder="Enter JSON"
  className="font-mono text-sm min-h-[100px]"
  aria-invalid={!!error}
/>
```

5. For "relation" type Input:
```tsx
<Input
  id={field.name}
  {...formField}
  value={(formField.value as string) ?? ""}
  placeholder={`Enter ${field.options?.target || "record"} ID`}
  className="font-mono"
  aria-invalid={!!error}
/>
```

6. For default case Input:
```tsx
<Input
  id={field.name}
  {...formField}
  value={(formField.value as string) ?? ""}
  aria-invalid={!!error}
/>
```

Note: Switch component doesn't need aria-invalid as it's always valid (true/false).
  </action>
  <verify>bun run build passes</verify>
  <done>All DynamicField inputs have aria-invalid attribute when validation error exists</done>
</task>

<task type="auto">
  <name>Task 2: Add aria-invalid to static forms</name>
  <files>
    src/admin/components/schema/FieldForm.tsx
    src/admin/components/views/LoginPage.tsx
    src/admin/components/schema/CreateCollectionSheet.tsx
  </files>
  <action>
Add aria-invalid attributes to inputs in static forms.

**FieldForm.tsx:**
Add aria-invalid to the field name Input:
```tsx
<Input
  id="name"
  placeholder="e.g., title, description, price"
  {...register("name", {...})}
  disabled={loading}
  aria-invalid={!!errors.name}
/>
```

**LoginPage.tsx:**
1. Add aria-invalid to email Input:
```tsx
<Input
  id="email"
  type="email"
  value={email}
  onChange={(e) => setEmail(e.target.value)}
  placeholder="admin@bunbase.local"
  required
  aria-invalid={!!error}
/>
```

2. Add aria-invalid to password Input:
```tsx
<Input
  id="password"
  type="password"
  value={password}
  onChange={(e) => setPassword(e.target.value)}
  required
  aria-invalid={!!error}
/>
```

Note: LoginPage uses a single `error` state for both fields since the error message is generic ("Invalid credentials"). Both inputs get aria-invalid when there's an error.

**CreateCollectionSheet.tsx:**
First read the file to understand its structure, then add aria-invalid to the collection name Input.
Likely pattern:
```tsx
<Input
  id="name"
  {...register("name", {...})}
  aria-invalid={!!errors.name}
/>
```
  </action>
  <verify>bun run build passes</verify>
  <done>All static form inputs have aria-invalid attribute when validation error exists</done>
</task>

</tasks>

<verification>
1. Build passes: `bun run build`
2. Test with browser dev tools:
   - Submit empty required field in record form
   - Verify input has `aria-invalid="true"` attribute in DOM
3. Test with screen reader (optional): VoiceOver should announce "invalid" for fields with errors
</verification>

<success_criteria>
- All form inputs have aria-invalid attribute bound to their error state
- Existing inline error messages continue to display correctly
- No visual regression in form layouts
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/13-ui-polish/13-02-SUMMARY.md`
</output>
