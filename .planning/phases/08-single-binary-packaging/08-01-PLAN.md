---
phase: 08-single-binary-packaging
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/cli.ts
autonomous: true

must_haves:
  truths:
    - "Binary accepts --port or -p flag to override default port 8090"
    - "Binary accepts --db flag to override default database path bunbase.db"
    - "Binary accepts --help or -h flag to display usage information"
    - "Invalid port number (non-numeric, out of range) causes clean exit with error message"
  artifacts:
    - path: "src/cli.ts"
      provides: "CLI entry point with argument parsing"
      exports: ["default execution"]
      min_lines: 40
  key_links:
    - from: "src/cli.ts"
      to: "./api/server"
      via: "import startServer"
      pattern: "import.*startServer.*from.*api/server"
---

<objective>
Create CLI entry point with argument parsing for the compiled binary.

Purpose: Enable port and database path configuration via command-line flags, making the binary flexible for different deployment environments.

Output: `src/cli.ts` that parses `--port`, `--db`, and `--help` arguments before starting the server.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/08-single-binary-packaging/08-RESEARCH.md
@src/api/server.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CLI entry point with argument parsing</name>
  <files>src/cli.ts</files>
  <action>
Create `src/cli.ts` that serves as the entry point for the compiled binary.

Use Node's built-in `util.parseArgs` (zero dependencies) to parse CLI arguments:

1. **Options to support:**
   - `--port` or `-p` (string, default: "8090") - Port to listen on
   - `--db` (string, default: "bunbase.db") - Database file path
   - `--help` or `-h` (boolean) - Show help message

2. **Help output format:**
```
BunBase - Backend-in-a-box

Usage: bunbase [options]

Options:
  -p, --port <port>  Port to listen on (default: 8090)
  --db <path>        Database file path (default: bunbase.db)
  -h, --help         Show this help message

Examples:
  bunbase                    # Start on port 8090 with bunbase.db
  bunbase --port 3000        # Start on port 3000
  bunbase --db ./data/app.db # Use custom database path
```

3. **Port validation:**
   - Parse port as integer
   - Validate range 1-65535
   - Exit with error message if invalid: "Error: Invalid port number"

4. **Start server:**
   - Call `await startServer(port, dbPath)` from `./api/server`
   - Use parsed values (or defaults)

Configuration notes:
- Use `Bun.argv` (not `process.argv`) for argument array
- Use `strict: true` and `allowPositionals: true` in parseArgs options
  </action>
  <verify>
Run CLI directly to verify argument parsing:
```bash
bun src/cli.ts --help
bun src/cli.ts --port 3000 --db test.db
bun src/cli.ts -p 9090
```
Each should behave correctly (help prints usage, port/db override defaults).
  </verify>
  <done>
CLI entry point accepts --port, --db, --help flags and starts server with correct configuration.
  </done>
</task>

</tasks>

<verification>
1. `bun src/cli.ts --help` prints usage information and exits
2. `bun src/cli.ts` starts server on port 8090 with bunbase.db
3. `bun src/cli.ts --port 3000` starts server on port 3000
4. `bun src/cli.ts --db custom.db` creates custom.db database file
5. `bun src/cli.ts --port abc` exits with "Error: Invalid port number"
6. `bun src/cli.ts -p 99999` exits with "Error: Invalid port number"
</verification>

<success_criteria>
- CLI entry point exists at src/cli.ts
- All three flags work correctly (--port/-p, --db, --help/-h)
- Invalid port values cause clean error exit
- Server starts with correct configuration when arguments are valid
</success_criteria>

<output>
After completion, create `.planning/phases/08-single-binary-packaging/08-01-SUMMARY.md`
</output>
