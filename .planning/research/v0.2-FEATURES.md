# Feature Research: v0.2

**Domain:** Backend-in-a-box (BaaS) - User Authentication, File Uploads, Realtime/SSE
**Researched:** 2026-01-26
**Overall Confidence:** HIGH

This document analyzes how user authentication, file uploads, and realtime/SSE typically work in backend-in-a-box products like PocketBase, Supabase, and Appwrite to inform BunBase v0.2 requirements.

---

## User Authentication

### Table Stakes

Features users absolutely expect from any BaaS authentication system.

| Feature | Why Expected | Complexity | Notes |
|---------|--------------|------------|-------|
| Email/password signup | Core auth flow users expect | Medium | Create user record, hash password with argon2id |
| Email/password login | Standard credential authentication | Low | Verify password, return JWT token |
| JWT token-based sessions | Industry standard for stateless auth | Low | Already have JWT for admin auth, extend to users |
| Token refresh | Keep users logged in without re-auth | Low | Exchange valid token for new token |
| Request email verification | Prove email ownership | Medium | Requires email sending infrastructure |
| Confirm email verification | Complete verification flow | Low | Validate token, mark user verified |
| Request password reset | Account recovery essential | Medium | Requires email sending infrastructure |
| Confirm password reset | Complete recovery flow | Low | Validate token, update password |
| Auth collection type | Distinguish auth-enabled collections | Medium | New collection type with special fields |
| Password validation | Basic security requirements | Low | Min length, complexity rules |
| User record API access | Users access their own records | Medium | Auth rules on collections |

**PocketBase API Pattern:**
- `POST /api/collections/{collection}/auth-with-password` - Login
- `POST /api/collections/{collection}/auth-refresh` - Token refresh
- `POST /api/collections/{collection}/request-verification` - Request email verification
- `POST /api/collections/{collection}/confirm-verification` - Confirm with token
- `POST /api/collections/{collection}/request-password-reset` - Request reset
- `POST /api/collections/{collection}/confirm-password-reset` - Confirm reset

### Differentiators

Nice-to-have features that improve DX or competitive positioning.

| Feature | Value Proposition | Complexity | Notes |
|---------|-------------------|------------|-------|
| Username + password login | Alternative to email-based identity | Low | Any unique field as identity |
| Magic link authentication | Passwordless login option | Medium | Email with one-time login link |
| Multiple auth collections | Different user types (customers, staff) | Medium | PocketBase supports this |
| Session management UI | View/revoke active sessions in admin | Medium | Track login history |
| Auth rule templates | Pre-built permission patterns | Low | Common patterns like "owner only" |
| User impersonation | Admin can act as user for debugging | Medium | PocketBase has this feature |
| Account lockout | Block after failed login attempts | Low | Security enhancement |
| Password history | Prevent password reuse | Low | Store hashed history |

### Anti-Features

Features to deliberately NOT build in v0.2.

| Anti-Feature | Why Avoid | What to Do Instead |
|--------------|-----------|-------------------|
| OAuth2 providers | Significant complexity (callbacks, state management, provider-specific quirks) | Defer to v0.3; email/password sufficient for v0.2 |
| MFA/TOTP | Advanced security feature, overkill for initial auth | Defer to v0.3+; note in docs as future enhancement |
| SAML/SSO | Enterprise feature, complex setup | Out of scope for foreseeable future |
| Custom auth providers | Framework-level extensibility | Users can extend via hooks instead |
| SMS/phone authentication | Requires SMS gateway integration | Defer indefinitely; email is sufficient |
| Biometric authentication | Platform-specific, client responsibility | Not a server feature |
| Social login buttons in admin UI | OAuth deferred, no UI needed | Admin UI shows email/password only |

---

## File Uploads

### Table Stakes

Features users expect from any BaaS file storage system.

| Feature | Why Expected | Complexity | Notes |
|---------|--------------|------------|-------|
| File field type | Associate files with records | Medium | New field type in schema |
| Multipart upload | Standard file upload mechanism | Medium | Parse multipart/form-data |
| Local filesystem storage | Simple default storage | Low | Store in `pb_data/storage/` |
| File serving endpoint | Retrieve uploaded files | Low | `GET /api/files/{collection}/{record}/{filename}` |
| Filename sanitization | Security - prevent path traversal | Low | Remove special chars, add random suffix |
| File size limits | Prevent abuse | Low | Configurable max file size |
| MIME type validation | Basic file type checking | Low | Check Content-Type header |
| Multiple files per field | Common requirement | Medium | Array of filenames in field |
| File deletion | Clean up when record deleted | Low | Remove files from storage on record delete |
| File URL generation | Helper to build file URLs | Low | SDK/API helper method |

**Storage Structure (PocketBase pattern):**
```
pb_data/storage/
  {collectionId}/
    {recordId}/
      {filename_randomsuffix}.{ext}
      thumbs_{filename}/
        {size}_{filename}.{ext}
```

**PocketBase API Pattern:**
- Upload: Include in `POST/PATCH` multipart request to records API
- Download: `GET /api/files/{collectionIdOrName}/{recordId}/{filename}`
- Force download: Add `?download=1` query param

### Differentiators

Nice-to-have features that improve DX or competitive positioning.

| Feature | Value Proposition | Complexity | Notes |
|---------|-------------------|------------|-------|
| Image thumbnail generation | Auto-resize for previews | High | Requires image processing library |
| Protected files | Require auth token for access | Medium | Check view rules, generate short-lived tokens |
| File tokens | Short-lived URLs for protected files | Medium | 2-minute expiry tokens |
| Direct upload URLs | Skip app server for large files | High | Signed URL pattern |
| File append ("+") | Add files without replacing existing | Low | PocketBase uses `fieldname+` syntax |
| Image metadata extraction | EXIF data, dimensions | Medium | Parse image headers |
| Video thumbnail extraction | Preview frames for videos | High | Requires ffmpeg or similar |
| Configurable storage path | Custom storage location | Low | CLI flag or config option |

### Anti-Features

Features to deliberately NOT build in v0.2.

| Anti-Feature | Why Avoid | What to Do Instead |
|--------------|-----------|-------------------|
| S3/cloud storage | Significant complexity, configuration burden | Defer to v0.3; local storage sufficient for v0.2 |
| CDN integration | Infrastructure complexity | Users can put reverse proxy with CDN in front |
| Image transformations on-the-fly | Processing overhead, complexity | Pre-generate common sizes only |
| Video transcoding | Requires heavy processing, ffmpeg dependency | Out of scope; store original only |
| Chunked uploads | Complexity for large files | Use reasonable file size limits instead |
| Background upload processing | Queue infrastructure | Process synchronously for v0.2 |
| Virus scanning | Requires ClamAV or similar | Document as user responsibility |
| File versioning | Storage complexity | Single version only; overwrite on update |

---

## Realtime/SSE

### Table Stakes

Features users expect from any BaaS realtime system.

| Feature | Why Expected | Complexity | Notes |
|---------|--------------|------------|-------|
| SSE connection endpoint | Establish realtime connection | Medium | `GET /api/realtime` returns SSE stream |
| Client ID assignment | Identify connected clients | Low | Send `PB_CONNECT` event with ID on connect |
| Subscribe to collection | Watch all records in collection | Medium | `{collection}/*` subscription topic |
| Subscribe to record | Watch specific record | Medium | `{collection}/{recordId}` topic |
| Create events | Notify on record creation | Low | Send SSE event after record created |
| Update events | Notify on record modification | Low | Send SSE event after record updated |
| Delete events | Notify on record deletion | Low | Send SSE event after record deleted |
| Unsubscribe | Stop receiving events | Low | Remove client subscription |
| Connection keep-alive | Prevent connection timeout | Low | Periodic ping/comment events |
| Auto-disconnect inactive | Resource cleanup | Low | Close connections after 5 min inactivity |

**PocketBase Protocol:**
1. Client: `GET /api/realtime` - establishes SSE connection
2. Server: Sends `PB_CONNECT` event with `{clientId: "..."}`
3. Client: `POST /api/realtime` with `{clientId, subscriptions: ["users/*"]}`
4. Server: Sends events when subscribed records change:
   ```
   event: users
   data: {"action":"create","record":{...}}
   ```

**Event Format:**
```json
{
  "action": "create" | "update" | "delete",
  "record": { /* record data */ }
}
```

### Differentiators

Nice-to-have features that improve DX or competitive positioning.

| Feature | Value Proposition | Complexity | Notes |
|---------|-------------------|------------|-------|
| Auth-aware subscriptions | Apply collection rules to events | Medium | Only send events user can see |
| Subscription options | Include query params in subscription | Medium | Filter events server-side |
| Broadcast API | Send custom events from hooks | Low | Useful for notifications |
| Connection count metrics | Monitor realtime usage | Low | Track active connections |
| Reconnection support | Client reconnects with same subscriptions | Medium | EventSource handles reconnect |
| Batch events | Group rapid changes | Medium | Reduce event frequency |
| WebSocket alternative | For bidirectional needs | High | SSE covers most use cases |

### Anti-Features

Features to deliberately NOT build in v0.2.

| Anti-Feature | Why Avoid | What to Do Instead |
|--------------|-----------|-------------------|
| WebSocket support | SSE sufficient for server-to-client; adds complexity | SSE covers realtime notifications |
| Message queuing | Infrastructure complexity | Direct event dispatch; no persistence |
| Presence detection | Who's online features add complexity | Application can build on top of SSE |
| Typing indicators | Real-time collaboration feature | Out of scope; app-level feature |
| Room/channel abstraction | Beyond record-based events | Use collection subscriptions |
| Binary data streaming | SSE is text-only | Use file endpoints for binary |
| Message history/replay | Storage and query complexity | Client re-fetches missed data |
| Fan-out optimization | Scaling concern | Direct loops sufficient for v0.2 |

---

## UI Polish

### Table Stakes

UI improvements users expect in a production-ready admin interface.

| Feature | Why Expected | Complexity | Notes |
|---------|--------------|------------|-------|
| Responsive layout | Works on mobile/tablet | Medium | Already partially responsive; refine breakpoints |
| Loading states | Visual feedback during operations | Low | Skeleton loaders, spinners |
| Error toast notifications | User feedback on failures | Low | Already using sonner; ensure consistent |
| Success confirmations | Feedback on successful actions | Low | Toast messages |
| Form validation feedback | Inline validation errors | Low | Highlight invalid fields |
| Keyboard navigation | Power users expect it | Medium | Tab order, focus management |
| Consistent spacing | Professional appearance | Low | Review and standardize padding/margins |
| Icon consistency | Visual coherence | Low | Audit and standardize icon usage |

### Differentiators

Polish that elevates the admin UI above competitors.

| Feature | Value Proposition | Complexity | Notes |
|---------|-------------------|------------|-------|
| Smooth transitions | Modern, polished feel | Low | CSS transitions on route changes |
| Skeleton loaders | Perceived performance | Low | Show content shape while loading |
| Dark mode | Developer preference | Medium | Already using dark theme; ensure contrast |
| Table row hover effects | Interactive feedback | Low | Subtle highlight on hover |
| Modal animations | Smooth open/close | Low | Fade/scale transitions |
| Empty state illustrations | Friendly empty states | Low | Simple icons + helpful text |
| Sidebar collapse animation | Smooth navigation UX | Low | Transition width/opacity |
| Form field animations | Focus state transitions | Low | Border color, shadow transitions |
| Button loading states | Prevent double-submit | Low | Spinner inside button during action |
| Drag-and-drop reordering | Field order in schema editor | High | Defer unless time permits |

### Anti-Features

UI features to NOT build.

| Anti-Feature | Why Avoid | What to Do Instead |
|--------------|-----------|-------------------|
| Theme customization | Complexity for marginal value | Single dark theme is sufficient |
| Dashboard widgets/charts | Scope creep | Simple counts/stats are enough |
| Multi-language i18n | Significant effort | English only for v0.2 |
| Collaborative editing | Complex real-time sync | Single-admin focus |
| Mobile-optimized create/edit forms | Complex responsive forms | Desktop-first; mobile read-only acceptable |
| Undo/redo in forms | State management complexity | Standard browser back behavior |

---

## Dependencies

How v0.2 features depend on existing v0.1 capabilities.

### User Authentication Dependencies

| v0.2 Feature | Depends On | Notes |
|--------------|------------|-------|
| Auth collection type | Schema manager | Extend collection types with `type: "auth"` |
| Password hashing | Bun.password (existing) | Already using argon2id for admin |
| JWT tokens | jose library (existing) | Extend existing JWT utilities |
| User record CRUD | Records API (existing) | Auth records are still records |
| Email verification | **NEW: Email service** | Requires SMTP configuration |
| Password reset | **NEW: Email service** | Requires SMTP configuration |
| Auth middleware | Middleware pattern (existing) | Extend requireAdmin pattern |
| Auth rules | Query/filter system (existing) | Add collection-level rules |

### File Upload Dependencies

| v0.2 Feature | Depends On | Notes |
|--------------|------------|-------|
| File field type | Schema manager | Add `file` to FieldType enum |
| Multipart parsing | Bun.serve() | Native support via FormData |
| Storage directory | Filesystem | Create `pb_data/storage/` directory |
| File serving | Routes | New `/api/files/` endpoint |
| File deletion on record delete | Lifecycle hooks | afterDelete hook cleans up files |
| Protected files | Auth middleware | Check view rules for access |
| Thumbnails | **NEW: Image library** | Sharp or similar; may defer |

### Realtime/SSE Dependencies

| v0.2 Feature | Depends On | Notes |
|--------------|------------|-------|
| SSE endpoint | Bun.serve() streaming | Native Response streaming support |
| Client tracking | In-memory Map | Simple client ID -> connection map |
| Record events | Lifecycle hooks | afterCreate/Update/Delete trigger broadcasts |
| Auth-aware events | Auth middleware + collection rules | Filter events by visibility |
| Connection management | Server lifecycle | Track connections, handle cleanup |

### Email Service (New Dependency)

Email sending is required for email verification and password reset flows.

| Approach | Pros | Cons | Recommendation |
|----------|------|------|----------------|
| SMTP configuration | Universal, user controls email delivery | Requires external SMTP server | **Recommended for v0.2** |
| Embedded SMTP | No external dependency | Complex, deliverability issues | Avoid |
| External service (SendGrid, etc.) | Reliable delivery | Vendor lock-in, API keys | Document as option |

**Minimal Email Requirements:**
- SMTP host, port, user, password configuration
- Send email function with to, subject, body
- HTML and plain text email support
- Template placeholders for tokens/OTPs

---

## Feature Priority Matrix

| Feature | Table Stakes | Differentiator | Complexity | Priority |
|---------|-------------|----------------|------------|----------|
| Email/password auth | Yes | - | Medium | P0 |
| Token refresh | Yes | - | Low | P0 |
| Request/confirm verification | Yes | - | Medium | P0 |
| Request/confirm password reset | Yes | - | Medium | P0 |
| File field type | Yes | - | Medium | P0 |
| File upload/download | Yes | - | Medium | P0 |
| Local filesystem storage | Yes | - | Low | P0 |
| SSE connection | Yes | - | Medium | P0 |
| Subscribe to collection/record | Yes | - | Medium | P0 |
| Create/update/delete events | Yes | - | Low | P0 |
| Auth-aware subscriptions | - | Yes | Medium | P1 |
| Protected files | - | Yes | Medium | P1 |
| Image thumbnails | - | Yes | High | P2 |
| Loading/transition animations | - | Yes | Low | P1 |
| Responsive refinements | - | Yes | Medium | P1 |

---

## MVP Recommendation

For v0.2 MVP, prioritize in this order:

1. **User Authentication (P0)** - Complete auth flow is the most requested feature after CRUD
   - Auth collection type with email, password_hash, verified fields
   - Email/password signup and login
   - Token refresh
   - Email verification (with SMTP config)
   - Password reset (with SMTP config)

2. **File Uploads (P0)** - Second most requested capability
   - File field type
   - Local filesystem storage
   - File upload via multipart
   - File serving endpoint
   - File deletion on record delete

3. **Realtime/SSE (P0)** - Enables reactive applications
   - SSE connection endpoint
   - Collection and record subscriptions
   - Create/update/delete events
   - Auto-disconnect on inactivity

4. **UI Polish (P1)** - Improve perceived quality
   - Loading states and spinners
   - Smooth transitions
   - Error/success toasts
   - Responsive refinements

**Defer to v0.3:**
- OAuth2 providers
- S3/cloud storage
- Image thumbnails
- WebSocket alternative
- Protected files (if time permits in v0.2)

---

## Sources

**Authentication:**
- [PocketBase Authentication Documentation](https://pocketbase.io/docs/authentication/)
- [PocketBase API Records Reference](https://pocketbase.io/docs/api-records/)
- [JWT Security Best Practices - Curity](https://curity.io/resources/learn/jwt-best-practices/)
- [JWTs vs Sessions - Stytch](https://stytch.com/blog/jwts-vs-sessions-which-is-right-for-you/)
- [Appwrite vs Supabase Comparison](https://appwrite.io/blog/post/appwrite-compared-to-supabase)

**File Uploads:**
- [PocketBase Files Handling](https://pocketbase.io/docs/files-handling/)
- [File Upload and Serving - DeepWiki](https://deepwiki.com/pocketbase/pocketbase/6.2-file-upload-and-serving)
- [Storage Systems - DeepWiki](https://deepwiki.com/pocketbase/pocketbase/6-storage-systems)
- [BaaS Security and Privacy - Acropolium](https://acropolium.com/blog/baas-security-privacy/)

**Realtime/SSE:**
- [PocketBase API Realtime](https://pocketbase.io/docs/api-realtime/)
- [How Realtime Works - GitHub Discussion](https://github.com/pocketbase/pocketbase/discussions/5579)
- [better-sse npm package](https://www.npmjs.com/package/better-sse)
- [SSE Implementation Guide - DigitalOcean](https://www.digitalocean.com/community/tutorials/nodejs-server-sent-events-build-realtime-app)

**UI Polish:**
- [Dashboard Design Principles 2026 - DesignRush](https://www.designrush.com/agency/ui-ux-design/dashboard/trends/dashboard-design-principles)
- [Admin Dashboard Guide - WeWeb](https://www.weweb.io/blog/admin-dashboard-ultimate-guide-templates-examples)
- [Best Dashboard Designs - Mockplus](https://www.mockplus.com/blog/post/dashboard-design-best-practices-examples)

---

*Last updated: 2026-01-26*
